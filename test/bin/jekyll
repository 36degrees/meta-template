#!/usr/bin/env ruby
require 'json'
require 'liquid'
require 'jekyll'
require 'jekyll/liquid_extensions'

module Liquid
  class JekyllRenderer
    include Jekyll::LiquidExtensions
    attr_reader :template

    def initialize(template)
      @template = Template.parse(template)
    end

    def render(data)
      context = JSON.parse(data)
      template.render(context)
    end
  end
end

$stdout.write(
  Liquid::JekyllRenderer.new(ARGV.first).render(ARGV[1] || '{}')
)
